# Indexer of stardust migration objects

A simple application indexing custom data from the stardust-migration objects.

# Development

## Docker Setup

### 1. Build the Docker Image
To build the Docker image (forcing a fresh build without using cached layers), run:
```sh
docker compose build --no-cache
```

### 2. Run the Docker Container
To start the container in detached mode, run:
```sh
docker compose up -d
```

### 3. Stop the Docker Container
To stop the running container and remove the associated resources, use:
```sh
docker compose down
```

---

### Environment Configuration

The application uses a pre-existing `.env` file for configuration. You can modify it if needed.

#### Description of Variables
- **`DATABASE_URL`**: Path or connection string for the database.
- **`LOG_LEVEL`**: Logging level (e.g., `INFO`, `DEBUG`).
- **`DB_POOL_SIZE`**: Maximum database connection pool size.
- **`DB_CONNECTION_TIMEOUT_SECS`**: Timeout (in seconds) for database connections.
- **`REST_API_SOCKET_ADDRESS`**: Address where the REST API will listen (e.g., `0.0.0.0:3000`).
- **`REMOTE_STORE_URL`**: Option to synchronize data from a remote Fullnode through REST API.
- **`DOWNLOAD_QUEUE_SIZE`**: Max queue size of checkpoints for the Indexer to process.
- **`CHECKPOINT_PROCESSING_BATCH_DATA_LIMIT`**: Limit indexing parallelism on big checkpoints to avoid OOM, by limiting the total size of batch checkpoints to ~20MB.
- **`RESET_DB`**: Indicates whether to reset the database on startup (`true` or `false`).
- **`PACKAGE_ID`**: Instruct the Indexer to store Objects generated by these package IDs

### Notes
- Any changes to the `.env` file will take effect the next time the container is built or restarted.
- Keep the `.env` file secure, as it may contain sensitive information.

## Manual Setup

1. [Install Diesel CLI][diesel-getting-started]
2. Run `diesel setup`

### Run the application

```sh
$ cargo run
```

### Run the tests

```sh
$ cargo test
```

## Supported features

* Index expiration unlock conditions for shared Nft and Basic outputs.
* Set a custom package defining the stardust outputs, assuming that the type
  layout is the same as in [iota-framework][].
* Expose a REST API to serve the indexed data.

[diesel-getting-started]: https://diesel.rs/guides/getting-started.html
